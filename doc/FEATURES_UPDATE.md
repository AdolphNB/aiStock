# 自选股功能更新说明

## 功能概述

本次更新实现了两个选项卡（交易监控和选股）之间的自选股同步功能，并在交易监控选项卡中添加了强大的股票搜索和管理功能。

## 主要更新

### 1. 自选股数据持久化

- 自选股数据现在保存在 `config/config.json` 文件中的 `favorites` 字段
- 应用重启后自选股列表会自动加载
- 所有自选股操作实时同步到配置文件

### 2. 跨选项卡同步

- **交易监控**选项卡的"自选股"列表与**选股**选项卡的"我的自选股池"完全同步
- 在任一选项卡添加/删除自选股，另一个选项卡会立即更新
- 通过 PyQt6 信号机制实现实时同步

### 3. 智能搜索功能（交易监控选项卡）

在"自选股"框下方新增了搜索功能，支持多种搜索方式：

#### 搜索方式

1. **股票代码搜索**
   - 输入: `000858`
   - 结果: 五粮液 (000858)

2. **中文名称模糊搜索**
   - 输入: `核电`
   - 结果: 中国核电、中核科技等所有包含"核电"的股票

3. **拼音首字母搜索** ⭐新功能
   - 输入: `zghd`
   - 结果: 中国核电 (拼音首字母: ZhongGuoHeDian)
   
   - 输入: `zgpa`
   - 结果: 中国平安

4. **完整拼音搜索**
   - 输入: `zhongguo`
   - 结果: 所有包含"中国"的股票

#### 使用方法

1. **实时搜索**
   - 在搜索框中输入任意关键词
   - 搜索结果会实时显示在下方列表中（最多显示20条）
   - 结果按匹配优先级排序：代码 > 名称 > 拼音首字母 > 完整拼音

2. **添加自选股**
   
   方式一：使用搜索结果
   - 在搜索框输入关键词
   - 从弹出的搜索结果中点击选择
   - 点击 ➕ 按钮添加到自选股
   
   方式二：双击添加
   - 在搜索结果列表中**双击**任意股票
   - 直接添加到自选股，无需点击按钮
   
   方式三：回车添加
   - 输入搜索关键词
   - 使用方向键选择搜索结果
   - 按回车键选中，再点击 ➕ 按钮

3. **删除自选股**
   - 在自选股列表中选择要删除的股票
   - 点击 ➖ 按钮
   - 确认删除

## 技术实现

### 依赖包更新

新增依赖: `pypinyin>=0.53.0`

安装方法:
```bash
uv pip install pypinyin
```

或者:
```bash
uv sync
```

### 核心组件

1. **ConfigManager** (`src/utils/config_manager.py`)
   - `get_favorites()`: 获取自选股列表
   - `set_favorites()`: 设置自选股列表
   - `add_favorite(code, name)`: 添加单个自选股
   - `remove_favorite(code)`: 删除单个自选股

2. **MainWindow** (`src/ui/main_window.py`)
   - 提供 `favoritesUpdated` 信号用于同步
   - 统一管理所有自选股操作
   - 自动去重处理

3. **TradingMonitorTab** (`src/ui/tabs/trading_monitor.py`)
   - 提供 `favoriteAdded` 和 `favoriteRemoved` 信号
   - 实现智能搜索功能
   - 支持拼音首字母搜索

4. **SmartSelectionTab** (`src/ui/tabs/smart_selection.py`)
   - 提供 `favoriteAdded` 和 `favoriteRemoved` 信号
   - 与交易监控选项卡同步

## 使用示例

### 示例1: 快速添加"中国核电"

1. 进入"交易监控"选项卡
2. 在搜索框输入: `zghd` 或 `核电` 或 `601985`
3. 双击搜索结果中的"中国核电"
4. 自动添加到自选股

### 示例2: 批量查找银行股

1. 在搜索框输入: `银行`
2. 查看所有包含"银行"的股票
3. 选择需要的股票双击添加

### 示例3: 从AI分析结果添加自选股

1. 进入"选股"选项卡
2. 使用筛选条件或AI分析
3. 在"AI精选结果"中选择股票
4. 点击"➕ 添加到自选"
5. 切换到"交易监控"选项卡，自选股已同步

## 注意事项

1. **首次使用需要安装pypinyin包**
   ```bash
   uv pip install pypinyin
   ```

2. **搜索性能**
   - 股票列表加载需要几秒钟
   - 加载完成后搜索是实时的
   - 支持5000+支股票的快速搜索

3. **数据同步**
   - 自选股变更会立即保存到配置文件
   - 两个选项卡之间的同步是实时的
   - 不会出现数据不一致的情况

4. **重复添加保护**
   - 系统会自动检测重复的自选股
   - 重复添加会被忽略（不会提示错误）

## 后续优化建议

1. 添加自选股分组功能
2. 支持自选股排序（按代码、名称、涨跌幅等）
3. 添加自选股导入/导出功能
4. 实时更新自选股的价格和涨跌幅数据
5. 添加自选股备注功能

## 问题反馈

如有问题，请联系开发者。
